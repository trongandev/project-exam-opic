import{c as p,j as e,B as x,C as P,a as _,b as z,d as E,e as M,f as L,g as $,h as A,E as f,S as O,i as B,k as w,l as F,v as N,u as H,m as X,n as K,t as y,o as j}from"./index-BsyPbx_v.js";import{L as m,b as d}from"./react-CZ6hAaVq.js";import{S as R,D as U,a as q,b as G,c as J,d as Q,e as v}from"./separator-1Hrfc9eW.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],W=p("clock",V);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Z=p("pen",Y);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],se=p("settings",ee);function ae({currentPage:s,totalPages:l,onPageChange:o}){const c=r=>{r>=1&&r<=l&&o(r)},a=()=>{const r=[];for(let t=1;t<=l;t++)r.push(e.jsx(x,{variant:t===s?"default":"outline",onClick:()=>c(t),className:t===s?" text-white":"",children:t},t));return r};return l<=1?null:e.jsxs("div",{className:"flex flex-col items-center gap-4 mt-10",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(x,{variant:"outline",onClick:()=>c(s-1),disabled:s===1,children:"Previous"}),a(),e.jsx(x,{variant:"outline",onClick:()=>c(s+1),disabled:s===l,children:"Next"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Trang ",s," / ",l]})]})}function te({topic:s,idUser:l,loadingDelete:o,handleDeleteTopic:c}){return e.jsxs(P,{className:"bg-white border-primary/20 hover:shadow-lg shadow-primary/10 transition-all duration-300 relative group",children:[e.jsx(_,{className:"",children:e.jsx("div",{className:"flex items-center gap-3 justify-between",children:e.jsxs("div",{className:"",children:[e.jsx(z,{className:"text-xl font-semibold text-gray-900 flex-1",children:s.name}),e.jsx("p",{className:"text-gray-500 text-sm line-clamp-3",children:s.desc})]})})}),e.jsx(R,{}),e.jsxs(E,{children:[e.jsxs("div",{className:"mb-5",children:[e.jsx("p",{children:"Các chủ đề có trong topic:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.data.map(a=>e.jsx(M,{variant:"secondary",className:"mr-2 mb-2",children:a.categoryId.title},a._id))})]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx(m,{to:`/profile/${s.userId._id}`,children:e.jsx(L,{user:s.userId})}),e.jsxs("div",{className:"flex items-center justify-between gap-5 w-full text-gray-500",children:[e.jsxs("div",{className:"w-full  ",children:[e.jsx("h1",{className:"font-medium text-gray-700",children:s.userId.displayName}),e.jsxs("div",{className:"flex gap-2 items-center text-xs",title:`Ngày tạo: ${A(new Date(s.createdAt),"PPPP",{locale:N})}`,children:[e.jsx(W,{size:14})," ",$(new Date(s.createdAt),new Date,{addSuffix:!0,locale:N})]})]}),e.jsxs("div",{className:"text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1 flex-1",children:[e.jsx(f,{size:14})," ",s.viewCount]}),e.jsxs("div",{className:"flex items-center gap-1 flex-1 ",children:[e.jsx(O,{size:14,className:"fill-yellow-500 stroke-yellow-500"}),e.jsx("p",{children:s.rating.length>0?s.rating.reduce((a,r)=>a+r.score,0)/s.rating.length:"5.0"}),e.jsx("p",{children:s.rating.length?`(${s.rating.length})`:""})]})]})]})]})]}),e.jsxs(B,{className:"gap-2",children:[e.jsx(m,{to:`/topic/${s.slug}`,className:"block w-full",children:e.jsxs(x,{className:"w-full bg-primary hover:bg-primary/90 text-white group-hover:shadow-md transition-all",children:[e.jsx(f,{}),"Xem chi tiết"]})}),l===s.userId._id&&e.jsxs(U,{children:[e.jsx(q,{children:e.jsx(x,{variant:"outline",children:e.jsx(se,{})})}),e.jsxs(G,{children:[e.jsx(J,{children:"Tính năng"}),e.jsx(Q,{}),e.jsx(m,{to:`edit-topic/${s._id}`,children:e.jsxs(v,{children:[e.jsx(Z,{}),"Chỉnh sửa"]})}),e.jsx(v,{variant:"destructive",onClick:()=>c(s._id),disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(w,{}),"Đang xóa..."]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{}),"Xóa"]})})]})]})]})]},s._id)}function re(){const[s,l]=d.useState([]),[o,c]=d.useState(!1),[a,r]=d.useState({currentPage:1,totalPages:1,pageSize:6,totalItems:0}),[t,C]=d.useState(1),[b,u]=d.useState(!1),[S,k]=d.useState(""),{user:D}=H();d.useEffect(()=>{(async()=>{c(!0);try{const n=await y.getAllTopics(t,a.pageSize);l(n.data.data);const h=n.data.data.map(g=>g.name).join(", ");k(h),r({currentPage:n.data.pagination.currentPage,totalPages:n.data.pagination.totalPages,pageSize:n.data.pagination.pageSize,totalItems:n.data.pagination.totalItems})}catch(n){console.error("Error fetching topics:",n),j.error("Không thể tải dữ liệu")}finally{c(!1)}})()},[t,a.pageSize]);const T=i=>{i!==t&&i>=1&&i<=a.totalPages&&C(i)},I=async i=>{try{u(!0);const n=await y.deleteTopic(i);j.success(n.data.message),l(h=>h.filter(g=>g._id!==i))}catch(n){j.error(n?.message)}finally{u(!1)}};return e.jsxs("div",{className:"px-4 xl:px-0 max-w-7xl mx-auto my-20 min-h-screen",children:[e.jsx(X,{title:"Tổng hợp topic",description:`Danh sách các topic đã được tạo: ${S}`}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:["Tổng hợp topic",a.totalItems>0&&e.jsxs("span",{className:"text-lg font-normal text-gray-600",children:["(",a.totalItems," topic",a.totalItems>1?"s":"",")"]})]}),e.jsx("p",{className:"text-gray-600",children:"Tham khảo các topic mà người dùng đóng góp hoặc bấm vào nút ở dưới để"}),e.jsx(m,{to:"/topic/create-topic",children:e.jsxs(x,{className:"mt-2",children:[e.jsx(K,{})," Đóng góp topic"]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5",children:o?e.jsx("div",{className:"flex items-center justify-center h-[500px] col-span-full",children:e.jsx(w,{})}):s.length>0?s.map(i=>e.jsx(te,{topic:i,idUser:D?._id,loadingDelete:b,handleDeleteTopic:I},i._id)):e.jsxs("div",{className:"flex flex-col items-center justify-center h-[300px] col-span-full text-gray-500",children:[e.jsx("p",{className:"text-lg font-medium mb-2",children:"Chưa có topic nào"}),e.jsx("p",{className:"text-sm",children:"Hãy là người đầu tiên đóng góp topic!"})]})}),e.jsx(ae,{currentPage:t,totalPages:a.totalPages,onPageChange:T})]})}export{re as default};
